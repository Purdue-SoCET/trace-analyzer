# Trace Analyzer

This utility parses the instruction traces generated by the AFTx07 CPU tracker and generates statistics based on the types of instructions retired.

## Build

This project has the following dependencies:

| Name | Version |
|------|---------|
| cmake | >= 3.0 |
| cxx | >= 17 |
| llvm | 15 |
| tbb | 2021.9.0 |

This project also depends on LLVM build artifacts which are not installed by their build system. The `$LLVM_BUILD_DIR` variable must be set to the build directory of your local LLVM build.

```sh
mkdir build
cd build
cmake -DCMAKE_BUILD_TYPE=Release -G Ninja ..
ninja
```

### Common errors on asicfab

A common issue with asicfab is the use of the global `ccache` compiler which is far too old. This can be remedied by doing the following:

```sh
module load gcc
CC=gcc CXX=g++ cmake ...
```

## Running

The trace analyzer binary has a simple CLI to determine how to output the data that it generates. The syntax can be seen below:

```sh
./trace_analyzer <trace log> <binary file> [--format=<normal,json,matlab>]
```

Note that `<binary file>` refers to the ELF file which has not been dumped into a raw hex file yet.

The normal output is a style which presents the data as a table as seen below:

```
Statistics
=========================
Type         Count      %
=========================
ALU:         3261   0.16%
Mem:      1231363  61.37%
Branch:    770303  38.39%
Call:        1470   0.07%
Mul/Div:       30   0.00%
System:         6   0.00%
```

The JSON output is a style which formats the data as a JSON object with `count` and `total` fields. The `count` field is an object which contains fields for each type of instruction that trace-analyzer is able to understand.

```
{
    "count": {
        "alu": 3261,
        "mem": 1231363,
        "branch": 770303,
        "call": 1470,
        "muldiv": 30,
        "system": 6
    }
    "total": 2006433
}
```

The MATLAB output is a style which formats the data as a number of MATLAB variables which can be used to create pie charts.

```
instr_count = [3261, 1231363, 770303, 1470, 30, 6];
instr_labels = {'alu', 'mem', 'branch', 'call', 'muldiv', 'system'};
total = 2006433;
```
